asyncapi: "3.0.0"
info:
  title: Order Events
  version: "1.0.0"
  description: >
    Asynchronous events published by the order-service when order
    lifecycle transitions occur.  Consumed by notification-service
    and any future event-driven subscribers.

servers:
  development:
    host: redis:6379
    protocol: redis
    description: Development Redis server for Pub/Sub

channels:
  order/created:
    address: order/created
    description: Published when a new order is created.
    messages:
      orderCreated:
        $ref: "#/components/messages/OrderCreated"

  order/shipped:
    address: order/shipped
    description: Published when an order is shipped.
    messages:
      orderShipped:
        $ref: "#/components/messages/OrderShipped"

operations:
  publishOrderCreated:
    action: send
    channel:
      $ref: "#/channels/order~1created"
    summary: Publish order creation event
    messages:
      - $ref: "#/channels/order~1created/messages/orderCreated"

  publishOrderShipped:
    action: send
    channel:
      $ref: "#/channels/order~1shipped"
    summary: Publish order shipment event
    messages:
      - $ref: "#/channels/order~1shipped/messages/orderShipped"

components:
  messages:
    OrderCreated:
      name: OrderCreated
      title: Order Created Event
      contentType: application/json
      payload:
        type: object
        required:
          - order_id
          - user_id
          - items
          - total
          - created_at
        properties:
          order_id:
            type: string
            format: uuid
            description: Unique order identifier
          user_id:
            type: string
            format: uuid
            description: ID of the user who placed the order
          items:
            type: array
            items:
              type: object
              required:
                - product_id
                - quantity
                - price
              properties:
                product_id:
                  type: string
                quantity:
                  type: integer
                  minimum: 1
                price:
                  type: number
                  format: float
                  minimum: 0
          total:
            type: number
            format: float
            description: Total order value
          created_at:
            type: string
            format: date-time
            description: ISO 8601 timestamp of order creation

    OrderShipped:
      name: OrderShipped
      title: Order Shipped Event
      contentType: application/json
      payload:
        type: object
        required:
          - order_id
          - user_id
          - shipped_at
          - tracking_number
        properties:
          order_id:
            type: string
            format: uuid
            description: Unique order identifier
          user_id:
            type: string
            format: uuid
            description: ID of the user who placed the order
          shipped_at:
            type: string
            format: date-time
            description: ISO 8601 timestamp of shipment
          tracking_number:
            type: string
            description: Carrier tracking number
